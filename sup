# Custom bash script to create website project that optionally works with git.

# Github Username
userName=#Your username here.

# Variable defaults.
webpack=1
git=1
projectName=""

# Usage function.
usage() {
    printf "Usage: sup -n <PROJECT_NAME> <OPTIONS>\n"
}

createRepo() {
    answer=""
    while [ "$answer" != "y" -o "$answer" != "n" ]
    do 
        echo "Repository doesn't exist. Create a public repository? (Requires GitHub-cli) (y/n)"
        read answer
        if [ "$answer" == "y" ]; then
            eval "gh repo create $projectName --public"
            break
        elif [ "$answer" == "n" ]; then
            printf "\033[0;31mAborted\n"
            exit 1
        fi
    done
}

while getopts gwn: flag
do
    case "${flag}" in
        g) git=0;;
        w) webpack=0;;
        n) projectName=${OPTARG};;
        *) usage
           exit 1;;
    esac
done

if [ "$projectName" == "" ]; then
    usage
    exit 1
fi

if [ -d "./$projectName" ]; then
    printf "\033[0;31mDirectory with the project name already exists!\033[0m\n"
    exit 1
fi

if [ $git -eq 0 ]; then
    statusCode=$(curl --write-out %{http_code} --silent --output /dev/null https://github.com/$userName/$projectName)
    case $statusCode in
        404) createRepo;;
        000) printf "\033[0;31mCannot connect to the remote repository!\033[0m\n"
             exit 1;;
        *) eval "git clone git@github.com:$userName/$projectName.git";;
    esac
else
    mkdir $projectName
fi

while true
do
    cd $projectName

    if [ $git -eq 0 ]; then
        touch README.md
    fi 

    if [ $webpack -eq 0 ]; then
        eval "npm init"
        eval "npm install webpack webpack-cli --save-dev"
        if [ $git -eq 0]; then
            cd node_modules
            touch .gitignore
            cd ..
        fi
        mkdir src
        cd src
        touch index.js
        cd ..
        mkdir dist
        cd dist
        touch index.html
        cd ..
        touch webpack.config.js
        sed -i 's/"scripts": {/"scripts": {\n   "build": "webpack",\n   "watch": "webpack --watch",/' 'package.json'
    else
        mkdir assets
        touch index.html
        touch style.css
        touch script.js
    fi

    if [ $git -eq 0 ]; then
        answer=""
        while [ "$answer" != "y" -o "$answer" != "n" ]
        do 
            echo "Would you like to commit? (y/n)"
            read answer
            if [ "$answer" == "y" ]; then
                eval "git add ."
                eval "git commit -m 'Initial commit.'"
                break
            elif [ "$answer" == "n" ]; then
                break
            fi
        done
        break
    else
        break
    fi
done

printf "\033[0;32mSup setup complete.\033[0m\n"
exit 1